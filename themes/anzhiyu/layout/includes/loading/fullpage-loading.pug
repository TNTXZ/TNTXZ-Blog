- loading_img = theme.preloader.avatar ? theme.preloader.avatar : theme.avatar.img
#loading-box(onclick='document.getElementById("loading-box").classList.add("loaded")')
  .loading-bg
    img.loading-img(alt="加载头像" class='nolazyload' src=url_for(loading_img))
    .loading-image-dot
  .loading-quote
    .quote-content
    .quote-author
script.
  // 本地获取名言
  async function fetchQuote() {
    try {
      // 从本地文件获取名言
      const response = await fetch('/saying.txt');
      const text = await response.text();
      // 将文本按行分割，过滤空行
      const quotes = text.split('\n').filter(quote => quote.trim() !== '');
      
      if (quotes.length > 0) {
        // 随机选择一条名言
        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
        // 分割名言和作者
        const quoteParts = randomQuote.split('——');
        if (quoteParts.length === 2) {
          document.querySelector('.quote-content').textContent = quoteParts[0].trim();
          document.querySelector('.quote-author').textContent = `— ${quoteParts[1].trim()}`;
        } else {
          // 如果格式不符合预期，使用默认名言
          document.querySelector('.quote-content').textContent = randomQuote;
          document.querySelector('.quote-author').textContent = '';
        }
      } else {
        // 如果没有名言，使用默认名言
        document.querySelector('.quote-content').textContent = '道可道，非常道；名可名，非常名。';
        document.querySelector('.quote-author').textContent = '— 《道德经》';
      }
    } catch (error) {
      console.error('Failed to fetch local quote:', error);
      // 加载失败时显示默认名言
      document.querySelector('.quote-content').textContent = '道可道，非常道；名可名，非常名。';
      document.querySelector('.quote-author').textContent = '— 《道德经》';
    }
  }

  // 初始化名言
  fetchQuote();

  const preloader = {
    endLoading: () => {
      document.getElementById('loading-box').classList.add("loaded");
    },
    initLoading: () => {
      document.getElementById('loading-box').classList.remove("loaded")
    }
  }
  window.addEventListener('load',()=> { preloader.endLoading() })
  setTimeout(function(){preloader.endLoading();},10000)

  if (!{theme.pjax && theme.pjax.enable}) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
