- loading_img = theme.preloader.avatar ? theme.preloader.avatar : theme.avatar.img
#loading-box(onclick='document.getElementById("loading-box").classList.add("loaded")')
  .loading-bg
    img.loading-img(alt="加载头像" class='nolazyload' src=url_for(loading_img))
    .loading-image-dot
  .loading-quote
    .quote-content
    .quote-author
script.
  // 获取名言
  async function fetchQuote() {
    try {
      // 使用CORS代理或者直接请求
      const response = await fetch('https://uapis.cn/api/v1/saying', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
        mode: 'cors'
      });
      const data = await response.json();
      console.log('Quote API response:', data);
      if (data.code === 200 && data.data) {
        document.querySelector('.quote-content').textContent = data.data.content;
        document.querySelector('.quote-author').textContent = `— ${data.data.author}`;
      } else {
        // 如果API返回错误，使用默认名言
        document.querySelector('.quote-content').textContent = '加载中...';
        document.querySelector('.quote-author').textContent = '';
      }
    } catch (error) {
      console.error('Failed to fetch quote:', error);
      // 加载失败时显示默认名言
      document.querySelector('.quote-content').textContent = '道可道，非常道；名可名，非常名。';
      document.querySelector('.quote-author').textContent = '— 《道德经》';
    }
  }

  // 初始化名言
  fetchQuote();

  const preloader = {
    endLoading: () => {
      document.getElementById('loading-box').classList.add("loaded");
    },
    initLoading: () => {
      document.getElementById('loading-box').classList.remove("loaded")
    }
  }
  window.addEventListener('load',()=> { preloader.endLoading() })
  setTimeout(function(){preloader.endLoading();},10000)

  if (!{theme.pjax && theme.pjax.enable}) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
